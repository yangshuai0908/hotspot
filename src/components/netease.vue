<template>
    <div class="home">
        <div class="hot_item">
            <div class="hot_header">
                <div class="header_title">
                    <svg t="1764726314700" class="icon" viewBox="0 0 1024 1024" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" p-id="5975" width="25" height="25">
                        <path
                            d="M182.727111 657.976889c6.257778-10.069333-4.892444-43.804444-4.892444-43.804445-45.056-39.253333-34.304 29.184-34.304 29.184 31.573333 49.777778 39.196444 14.620444 39.196444 14.620445z m181.248-29.240889s-50.517333 1.592889-39.253333 34.133333c0 0 76.117333 17.692444 83.342222-14.620444 0 0 5.233778-30.378667-44.088889-19.512889z m-200.817778-150.983111c-41.813333-44.202667 14.677333-58.424889 14.677334-58.424889 21.617778-59.847111-29.411556-53.589333-29.411556-53.589333-48.753778-8.704-19.569778 24.348444-19.569778 24.348444-8.419556 33.393778-34.304 43.804444-34.304 43.804445-67.584-14.449778-14.677333-63.260444-14.677333-63.260445-2.56-33.223111 48.924444-34.133333 48.924444-34.133333 17.408-2.161778 14.734222-19.456 14.734223-19.456-8.533333-37.774222-63.715556-19.512889-63.715556-19.512889C50.631111 316.984889 21.048889 390.087111 21.048889 390.087111c-19.342222 36.693333 29.411556 58.424889 29.411555 58.424889 17.294222 29.468444-29.411556 77.937778-29.411555 77.937778 2.56 80.782222 48.981333 63.317333 48.981333 63.317333 4.551111 14.051556 63.715556 4.892444 63.715556 4.892445-1.365333-11.548444 44.088889-38.968889 44.088889-38.968889 8.533333-55.637333-14.734222-77.937778-14.734223-77.937778z m-44.145777 82.830222s-72.817778 1.194667-58.766223-29.240889c0 0 16.952889-41.528889 24.462223-38.968889 0 0 33.678222-39.025778 58.823111 9.728 0 0 10.126222 41.870222-24.462223 58.481778z m-117.532445 121.742222c-10.012444 62.748444 34.304 38.968889 34.304 38.968889-2.730667-29.866667 19.569778-43.804444 19.569778-43.804444v-63.374222c-40.391111-13.368889-53.873778 68.209778-53.873778 68.209777z m83.285333-48.696889c-14.961778 144.952889 34.247111 68.152889 34.247112 68.152889 8.704-122.88-34.247111-68.152889-34.247112-68.152889z m382.065778-228.920888c20.366222-36.636444-24.462222-68.209778-24.462222-68.209778l-29.411556-4.835556c-32.938667-17.521778-93.070222-4.892444-93.070222-4.892444-35.271111 11.150222-97.962667 4.892444-97.962666 4.892444-44.885333 54.101333-4.949333 107.121778-4.949334 107.121778v102.286222c-7.509333 93.696-44.032 141.255111-44.032 141.255111 4.039111 58.936889 39.139556 24.348444 39.139556 24.348445 24.689778-13.937778 34.304-126.634667 34.304-126.634667l24.462222 9.728v58.481778c12.856889 23.552 37.205333 13.653333 39.253333 9.671111 1.991111-3.925333 0-14.563556 0-14.563556-15.587556-6.542222-4.949333-53.589333-4.949333-53.589333-0.739556-25.144889 102.912-14.620444 102.912-14.620444 21.902222-53.703111-53.930667-38.912-53.930667-38.912-16.497778-1.820444-9.784889-34.133333-9.784889-34.133334 35.271111-18.204444 76.913778-1.649778 78.392889 9.784889 1.479111 11.377778 0 160.711111 0 160.711111 13.937778 92.785778 48.981333 34.133333 48.981334 34.133334 8.135111-24.348444-14.677333-97.450667-14.677334-97.450667-14.051556-54.784 9.784889-204.572444 9.784889-204.572444z m-151.893333 141.255111c-49.493333-8.931556-63.658667 4.835556-63.658667 4.835555-5.12-73.102222 63.715556-43.804444 63.715556-43.804444v38.968889zM422.798222 463.075556l-44.088889-4.835556 4.892445-24.405333c17.408-10.808889 14.677333-48.696889 14.677333-48.696889-48.924444-28.444444-44.088889 38.968889-44.088889 38.968889-1.991111 54.613333-39.139556 43.804444-39.139555 43.804444h-53.930667C213.105778 434.574222 251.278222 375.466667 251.278222 375.466667l48.981334-9.728c2.275556-18.659556 73.500444-9.728 73.500444-9.728 44.430222 2.673778 48.924444 34.076444 48.924444 34.076444v73.045333z m391.850667 141.255111s-94.378667 57.514667-117.532445 82.830222c0 0-71.111111 20.48-93.070222 24.348444 0 0-62.008889 64.284444 58.766222 34.076445 0 0 65.365333-27.704889 93.070223-58.424889 0 0 81.976889-62.008889 112.64-87.722667 0 0 5.461333-54.044444-53.873778 4.892445z m161.678222 0c1.934222-71.566222-88.177778-107.121778-88.177778-107.121778-7.793778-0.341333-68.551111-4.892444-68.551111-4.892445-45.966222-5.12-29.411556 34.133333-29.411555 34.133334-129.422222 106.951111-200.817778 107.121778-200.817778 107.121778-61.553778 37.888 9.784889 43.804444 9.784889 43.804444 61.44 4.152889 230.229333-141.255111 230.229333-141.255111 16.725333-8.704 39.196444 0 39.196445 0-0.739556 20.764444 9.784889 29.240889 9.784888 29.240889 96.711111-16.042667 44.088889 87.665778 44.088889 87.665778-30.378667 54.727111-102.855111 48.696889-102.855111 48.696888-44.316444-27.648-39.253333 0-39.253333 0 16.327111 111.445333 137.216 19.512889 137.216 19.512889 77.937778-58.993778 58.766222-116.906667 58.766222-116.906666z m-156.728889-199.68c55.352889-12.174222 14.677333-34.133333 14.677334-34.133334-18.204444-12.174222-127.374222 0-127.374223 0-27.875556 21.959111 0 34.133333 0 34.133334h112.64zM285.582222 390.087111c-18.602667 19.399111 4.892444 53.589333 4.892445 53.589333 17.294222 19.456 29.411556 4.835556 29.411555 4.835556v-34.076444c-10.808889-36.465778-34.304-24.348444-34.304-24.348445z m298.780445 194.844445c128-6.257778 181.248-97.450667 181.248-97.450667l122.481777-4.835556c41.301333-15.246222 39.196444-38.968889 39.196445-38.968889 10.524444-13.937778 0-63.317333 0-63.317333-4.209778-66.275556-34.304-77.937778-34.304-77.937778-23.722667-5.12-34.304-9.728-34.304-9.728-19.342222-7.566222-73.443556 0-73.443556 0-28.444444-18.545778-93.070222 0-93.070222 0-53.361778 18.090667-9.784889 43.804444-9.784889 43.804445 200.192-44.202667 200.817778 24.348444 200.817778 24.348444 19.854222 78.961778-19.626667 77.937778-19.626667 77.937778-53.134222-2.275556-44.088889 9.728-44.088889 9.728-18.033778 1.934222-24.462222-4.835556-24.462222-4.835556-35.157333-12.117333-68.608 9.728-68.608 9.728h-34.247111c-18.375111-2.332444-24.462222-29.240889-24.462222-29.240888v-77.937778c-25.656889-40.789333-44.145778 4.892444-44.145778 4.892444V453.404444c23.950222 56.718222 88.177778 34.133333 88.177778 34.133334-11.662222 29.866667-83.285333 53.532444-83.285333 53.532444-19.342222 2.958222-48.924444 0-48.924445 0-37.148444 26.737778 4.835556 43.804444 4.835556 43.804445z"
                            fill="#D81E06" p-id="5976"></path>
                    </svg>
                    <span>
                        网易新闻
                    </span>
                </div>
                <div class="header_title_search">
                    <svg t="1764662726037" class="icon" viewBox="0 0 1098 1024" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" p-id="15560" width="18" height="18">
                        <path
                            d="M476.808045 0.000043C213.401753 0.106685-0.031993 213.68973 0 477.074693S213.551052 953.98938 476.94668 954.021373s476.957344-213.412417 477.085315-476.808045A477.010665 477.010665 0 0 0 476.808045 0.000043z m273.761252 353.369671L441.861388 661.853674a43.1901 43.1901 0 0 1-62.023117 0L202.214984 484.251715a43.864079 43.864079 0 1 1 62.033781-62.033782l147.21959 147.21959 277.89897-276.86454a43.861946 43.861946 0 1 1 62.023117 62.033781z m0 0"
                            p-id="15561" fill="#0e793c"></path>
                    </svg>
                    热搜
                </div>
            </div>
            <div class="hot-content">
                <div v-for="(item, index) in WeiBoList" :key="item.id" class="hot-list-item"
                    :class="{ 'top-rank': index < 3, 'has-label': item.label }">
                    <div class="rank-number">{{ item.label || (index + 1) }}</div>
                    <div class="item-info">
                        <h4 class="item-title">{{ item.title }}</h4>
                    </div>
                    <div class="item-arrow">›</div>
                </div>
            </div>
            <div class="hot_footer">
                <div class="update-info">
                    <span>{{ timedata }}</span>
                </div>
                <div class="divider"></div>
                <div class="refresh-btn" @click="getWeiBoHotList" :class="{ loading: isLoading }">
                    <svg t="1764661476471" class="icon" viewBox="0 0 1024 1024" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" p-id="12307" width="24" height="24">
                        <path
                            d="M512 74.666667c214.229333 0 401.493333 159.274667 436.885333 368a32 32 0 0 1-39.317333 36.373333l-170.666667-42.666667a32 32 0 0 1 15.530667-62.08l119.402667 29.824c-48.106667-151.125333-191.829333-262.101333-354.432-265.386666L512 138.666667c-185.024 0-341.376 135.466667-369.024 316.458666a32 32 0 0 1-63.274667-9.664C112.128 233.322667 295.253333 74.666667 512 74.666667zM512 949.376c-214.208 0-401.493333-159.274667-436.864-368a32 32 0 0 1 42.773333-35.285333l170.666667 64a32 32 0 0 1-22.464 59.925333l-113.429333-42.538667 2.154666 6.165334c52.181333 144.042667 192.106667 248.490667 349.781334 251.669333l7.402666 0.064c183.04 0 338.261333-132.629333 368.170667-311.146667a32 32 0 0 1 63.125333 10.581334c-35.050667 209.237333-216.874667 364.586667-431.296 364.586666z"
                            fill="#8997aa" p-id="12308"></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import { onMounted, ref } from 'vue'
import { typeAPI } from '../api/WeiBo'

const WeiBoList = ref([]) // 获取热搜榜数据
const timedata = ref('') // 更新时间
const isLoading = ref(false) // 加载状态

const getWeiBoHotList = async () => {
    if (isLoading.value) return // 防止重复点击

    isLoading.value = true

    try {
        const res = await typeAPI.getHotListByType('netease')
        console.log(res);

        // 计算更新时间，传入时间戳
        const updateTime = calculateUpdateTime(res.timestamp)
        timedata.value = updateTime

        // name.value = res.api.name
        WeiBoList.value = res.data
    } catch (error) {
        console.error('获取数据失败:', error)
    } finally {
        isLoading.value = false
    }
}

// 计算更新时间的函数
const calculateUpdateTime = (date, time, timestamp) => {
    if (!date || !time) return '刚刚更新'

    try {
        // 优先使用时间戳（更准确）
        let apiTime
        if (timestamp) {
            // 将时间戳转换为毫秒（如果时间戳是秒级）
            const timestampMs = timestamp.toString().length === 10 ? timestamp * 1000 : timestamp
            apiTime = new Date(timestampMs)
        } else {
            // 解析日期时间字符串 (格式: "2025/12/2 16:18:19")
            const dateTimeStr = `${date} ${time}`
            apiTime = new Date(dateTimeStr.replace(/\//g, '-'))
        }

        // 获取当前时间
        const now = new Date()

        // 计算时间差（毫秒）
        const diffMs = now - apiTime
        const diffMinutes = Math.floor(diffMs / (1000 * 60))
        const diffHours = Math.floor(diffMinutes / 60)
        const diffDays = Math.floor(diffHours / 24)

        // 根据时间差返回相对时间
        if (diffMinutes < 1) {
            return '刚刚更新'
        } else if (diffMinutes < 60) {
            return `${diffMinutes}分钟前更新`
        } else if (diffHours < 24) {
            return `${diffHours}小时前更新`
        } else if (diffDays < 7) {
            return `${diffDays}天前更新`
        } else {
            // 超过一周显示具体日期
            const month = apiTime.getMonth() + 1
            const day = apiTime.getDate()
            return `${month}月${day}日更新`
        }
    } catch (error) {
        console.error('时间解析错误:', error)
        return '刚刚更新'
    }
}


onMounted(() => {
    getWeiBoHotList()
})
</script>

<style lang="scss" scoped>
.home {
    padding: 20px;

    .hot_item {
        position: relative;
        width: 360px;
        height: 413px;
        border-radius: 10px;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;

        .hot_header {
            height: 52px;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            padding: 0 20px;
            font-weight: 600;
            font-size: 16px;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);

            .header_title {
                display: flex;
                align-items: center;

                span {
                    margin-left: 8px;
                }
            }

            .header_title_search {
                display: flex;
                align-items: center;
                font-size: 12px;
                color: #0e793c;
                border-radius: 20px;
                background-color: #d1f4e0;
                padding: 4px;
            }
        }

        // 内容区域，可滚动
        .hot-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;

            // 自定义滚动条样式
            &::-webkit-scrollbar {
                width: 6px;
            }

            &::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 3px;
            }

            &::-webkit-scrollbar-thumb {
                background: #c1c1c1;
                border-radius: 3px;

                &:hover {
                    background: #a8a8a8;
                }
            }

            // 列表项样式
            .hot-list-item {
                display: flex;
                align-items: center;
                padding: 12px 16px;
                margin: 4px 12px;
                border-radius: 8px;
                transition: all 0.2s ease;
                cursor: pointer;
                position: relative;

                &:hover {
                    background-color: #f8f9fa;
                    transform: translateX(4px);
                }

                // 排名数字
                .rank-number {
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 12px;
                    font-weight: 600;
                    margin-right: 12px;
                    background-color: #f0f0f0;
                    color: #666;
                }

                // 有label的项目使用第1名颜色
                &.has-label .rank-number {
                    background-color: #ea444d;
                    color: white;
                    box-shadow: 0 2px 8px rgba(234, 68, 77, 0.3);
                }

                // 前三名特殊样式（仅当没有label时）
                &:nth-child(1):not(.has-label) .rank-number {
                    background-color: #ea444d;
                    color: white;
                    box-shadow: 0 2px 8px rgba(234, 68, 77, 0.3);
                }

                &:nth-child(2):not(.has-label) .rank-number {
                    background-color: #ed702d;
                    color: white;
                    box-shadow: 0 2px 8px rgba(237, 112, 45, 0.3);
                }

                &:nth-child(3):not(.has-label) .rank-number {
                    background-color: #eead3f;
                    color: white;
                    box-shadow: 0 2px 8px rgba(238, 173, 63, 0.3);
                }

                // 内容信息
                .item-info {
                    flex: 1;
                    min-width: 0;

                    .item-title {
                        font-size: 14px;
                        font-weight: 500;
                        color: #333;
                        line-height: 1.4;
                        margin: 0 0 6px 0;
                        display: -webkit-box;
                        -webkit-line-clamp: 2;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                    }
                }

                // 箭头
                .item-arrow {
                    color: #ccc;
                    font-size: 18px;
                    margin-left: 8px;
                    transition: transform 0.2s ease;
                }

                &:hover .item-arrow {
                    transform: translateX(2px);
                    color: #ff6b6b;
                }
            }
        }

        .hot_footer {
            width: 100%;
            height: 52px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-around;
            flex-shrink: 0;
            padding: 0 20px;
            font-size: 14px;
            border-radius: 0 0 10px 10px;

            .update-info {
                font-size: 12px;
                opacity: 0.9;
            }

            .divider {
                width: 1px;
                height: 20px;
                background-color: rgba(0, 0, 0, 0.1);
                margin: 0 16px;
            }

            .refresh-btn {
                .icon {
                    cursor: pointer;
                    transition: transform 0.3s ease;

                    &:hover {
                        transform: rotate(180deg);
                    }
                }

                &.loading .icon {
                    animation: spin 1s linear infinite;
                    cursor: not-allowed;

                    &:hover {
                        transform: none;
                    }
                }
            }

            @keyframes spin {
                from {
                    transform: rotate(0deg);
                }

                to {
                    transform: rotate(360deg);
                }
            }
        }
    }
}
</style>